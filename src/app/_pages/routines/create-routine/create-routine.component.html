<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a [routerLink]="['/']">Home</a></li>
    <li class="breadcrumb-item"> <a [routerLink]="['/routines']">Routines</a> </li>
    <li class="breadcrumb-item active" aria-current="page"> <span *ngIf="routine.RoutineID > 0">Edit</span><span *ngIf="routine.RoutineID === 0">Create</span> </li>
  </ol>
</nav>
<div *ngIf="!loaded || saving">
  <app-loader></app-loader>
</div>
<div *ngIf="loaded" class="p-3">
  <form [formGroup]="routineForm" (ngSubmit)="onSubmit()">
    <h2> Routine <div class="float-right"> <button class="btn btn-sm btn-primary">Save</button> <button class="btn btn-sm btn-danger" type="button" *ngIf="routine.RoutineID > 0" (click)="delete('Routines', routine.RoutineID)">Delete</button> </div>
    </h2>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    <div class="form-group d-none"> <label for="ID">ID</label> <input type="text" formControlName="RoutineID" class="form-control form-control-sm" /> </div>
    <div class="form-group"> <label for="Name">Routine Name</label> <input type="text" formControlName="Name" class="form-control form-control-sm" /> </div>
    <div formArrayName="Blocks" *ngIf="routine.Blocks">
      <h2> Blocks <button class="btn btn-sm btn-routine float-right" type="button" (click)="addBlock()"> Add Block </button> </h2>
      <div *ngFor=" let block of routineForm.get('Blocks').controls; let blockX = index " class="p-2 mt-3 bg-routine text-white">
        <div [formGroupName]="blockX">
          <div class="form-group d-none"> <label for="RoutineBlockID">ID</label> <input type="text" formControlName="RoutineBlockID" class="form-control form-control-sm" /> </div>
          <div class="form-row">
            <div class="form-group col-3"> <label for="BlockTypeID">Block Type</label> <select formControlName="BlockTypeID" class="form-control form-control-sm">
                <option *ngFor="let bType of blockTypes" [ngValue]="bType.BlockTypeID">{{ bType.Name }} </option>
              </select> </div>
            <div class="form-group col-3"> <label for="BlockOrder">Order</label> <input type="number" formControlName="BlockOrder" class="form-control form-control-sm" /> </div>
            <div class="form-group col-3"> <label for="ProgressType">Progress Type</label> <select formControlName="ProgressType" class="form-control form-control-sm">
                <option ngValue="None">None </option>
                <option ngValue="Block">Block </option>
                <option ngValue="Set">Set </option>
                <option ngValue="Exercise">Exercise </option>
              </select> </div>
            <div class="form-group col-3"> <label for="ProgressDiff">Progress Diff</label> <input type="number" formControlName="ProgressDiff" class="form-control form-control-sm" /> </div>
            <div class="form-group col-12" *ngIf="block.value.RoutineBlockID > 0"> <button class="btn btn-sm btn-danger w-100" type="button" (click)="delete('RoutineBlocks', block.value.RoutineBlockID, routineForm.get('Blocks'), blockX)">Delete</button> </div>
          </div>
          <div formArrayName="Sets">
            <h2> Sets <button class="btn btn-sm btn-workout float-right" type="button" (click)="addSet(block)">Add Set</button> </h2>
            <div *ngFor="let set of block.get('Sets').controls; let setX = index" class="p-2 mt-3 bg-light text-dark">
              <div [formGroupName]="setX">
                <div class="form-group d-none"> <label for="RoutineBlockSetID">ID</label> <input type="text" formControlName="RoutineBlockSetID" class="form-control form-control-sm" /> </div>
                <div class="form-row">
                  <div class="form-group col-12">
                    <div class="input-group input-group-sm">
                      <div class="input-group-prepend">
                        <div class="input-group-text">Set Number</div>
                      </div> <input type="number" type="number" formControlName="SetNumber" class="form-control form-control-sm" />
                      <div class="input-group-append"> <button class="btn btn-danger btn w-100" type="button" (click)="delete('RoutineBlockSet', set.value.RoutineBlockSetID, block.get('Sets'), setX)">Delete</button> </div>
                    </div>
                  </div>
                </div>
                <div formArrayName="Exercises">
                  <h2> Exercises <button class="btn btn-workout btn-sm float-right" type="button" (click)="addExercise(set)"> Add Exercise </button> </h2>
                  <div *ngFor="let exercise of set.get('Exercises').controls; let exerciseX = index" class="p-2 mt-3 bg-light text-dark exercise-div">
                    <div [formGroupName]="exerciseX">
                      <div class="form-group d-none"> <label for="RoutineBlockSetExerciseID">ID</label> <input type="text" formControlName="RoutineBlockSetExerciseID" class="form-control form-control-sm" /> </div>
                      <div class="form-row">
                        <div class="form-group col-12 col-lg-4">
                          <div class="input-group input-group-sm">
                            <div class="input-group-append"> <span class="input-group-text">Exercise</span> </div>
                            <input type="number" type="number" formControlName="ExerciseID" class="d-none" />
                            <input type="number" type="string" readonly [value]="exercise.value.Exercise ? exercise.value.Exercise.Name + ' - ' + exercise.value.Exercise.ExerciseType.Name : ''" class="form-control form-control-sm" (click)="selectExercise(exercise, exerciseX)" />
                            <div class="input-group-append" *ngIf="exercise.value.RoutineBlockSetExerciseID > 0">
                              <button class="btn btn-sm btn-danger w-100" type="button" (click)="delete('RoutineBlockSetExercises', exercise.value.RoutineBlockSetExerciseID, set.get('Exercises'), exerciseX)">Delete</button>
                            </div>
                          </div>
                        </div>
                        <div class="form-group col-12 col-lg-4">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend"> <span class="input-group-text">Reps</span> </div> <input type="number" formControlName="Reps" class="form-control form-control-sm" />
                            <div class="input-group-prepend input-group-append"> <span class="input-group-text">Type</span> </div> <select formControlName="RepTypeID" class="form-control form-control-sm">
                              <option *ngFor="let repType of repTypes" [ngValue]="repType.RepTypeID">{{ repType.Name }} </option>
                            </select>
                            <div class="input-group-append input-group-prepend"> <span class="input-group-text">WT</span> </div> <select formControlName="WeightTypeID" class="form-control form-control-sm">
                              <option *ngFor="let wType of weightTypes" [ngValue]="wType.WeightTypeID">{{ wType.Name }} </option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group col-12 col-lg-4">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend"> <span class="input-group-text">Rest</span> </div> <input type="text" formControlName="PostRest" class="form-control form-control-sm" />
                            <div class="input-group-append input-group-prepend"> <span class="input-group-text">Side</span> </div> <select formControlName="SideTypeID" class="form-control form-control-sm">
                              <option *ngFor="let sideType of sideTypes" [ngValue]="sideType.SideTypeID">{{ sideType.Name }}</option>
                            </select>
                            <div class="input-group-append input-group-prepend"> <span class="input-group-text">Order</span> </div> <input type="number" formControlName="ExerciseOrder" class="form-control form-control-sm" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>